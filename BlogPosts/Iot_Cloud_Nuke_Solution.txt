The IoT button cloud-nuke solution is designed to provide an efficient and automated way to clean up AWS resources in a development environment. By integrating an AWS IoT button with AWS Lambda and CloudFormation, this solution allows you to conveniently delete all resources in a specific AWS account and Organizational Unit (OU) with the simple press of a button. It's particularly useful for managing resources in a development environment, where frequent build-ups and tear-downs are common.

Solution Overview
The solution operates across AWS accounts, with the IoT button and Lambda function residing in the management account, and the target of the cleanup being the development account within the specified OU in AWS Organizations. <br>

Attached is an architectural diagram: <br>

<iframe frameborder="0" style="width:100%;height:500px;" src="https://viewer.diagrams.net/?highlight=0000ff&nav=1#R7Vpbc5s4FP41fnQGAQ72o42d3c6k3UyzO9s%2BZWRQsDYYUSF86a%2FfI5AxSMJ1m7iXaRJPgo6O7t939CF54IXr3R8c56u3LCbpwHXi3cCbD1wXXY99%2BCcte2Vx3evaknAaK9vRcE8%2FE2V0lLWkMSk6joKxVNC8a4xYlpFIdGyYc7btuj2ytNtqjhNiGO4jnJrWf2ksVrXVdZyj%2FU9Ck5XQMpY4eko4KzPVXMYyUues8aEW5VqscMy2LZO3GHghZ0zUT%2BtdSFI5rYcJq8vd9OQ2PeYkE2cVuGNTP0zzWfQx%2BeB%2Fcu%2BdT85Q1bLBaalm4i3OYLBrWanrTKMIxibUAMT%2BMF05o5mopnw0gw80HDqDEeSEMnXljjSDng66BmSmZB1dg54OugakV4%2B09pHewZbBSHWqd7T2nVYH4ePNWClSmpGwAacDxoTjmMI0hixlHGwVNLzZSqxTSCF43K6oIPc5juSsboFZYHtkmVD0QO4hrSZe1goEEBja4qqOaiUIX2xIvSC1T5rivKDLphQnUckLuiHvSVFXLq2AyFw%2Br3eJpPUV3hb%2BlURzXnX%2FDbRlzX3AChZQheDsiRyGOHC9cA7U92XHaZpqQ98QLihwbprSRNYsmGwIq1RKHqsaYT5oltxWqbnnqDmwNRHjYkViNRgFZGiC7HoZghreQSgjbE0E34OLKuAppqogNvQkTKRh2woJgXJatcKBP1JGrMJQ0tR9JCQ8KE5%2BBT8nBj%2FDlJXxu%2FKJLEKZ8yYrBM4iYlC0eCIiWqnJsQJUm1b4vZE96wOusdSP1Y%2B21O2KOutzWPxbvCTpHSuooDW8aBynNnQsmRBs3QJIRCTSv45CjkYhdESYRFcfCXLO4jISNQNmuZUKJHLPhl1v6O3F4qSLRe%2Bwi7SgOEYmEhG6FBLRtQExEsMeqpKMixVLWIbTxdE6q3bGBgJHn1smqV%2Btxn9EiL1aLlwK1l3fuk3Z0DdMLnSWlTwip%2FzUdAnME3Kqwol9tThJsYC42hUklrmvik45x%2FuWg9pGjzXfScMRBI122B9kx6S7xX%2FJfzI66Y88dMofHuoeH1HTDP0ZQHKMmHaLyyxaQUC7F6CnbvF6GePTAc0qQKwixCZErGLEFCQdt0oiWFrQjTZbYBqR6XZQFabRZrNJKL00spRGWul%2BAdO3P2jhfjEPkOOc3CDO2giaeH9aJth2gS%2BJJlzk9bAe6U72wx70OanDhYr6kLSF%2FbRG5wUjP7oadViJAjP2B2Mz9h9sLx%2F6PYOxb9jfYJiVsGTZK1N%2FEaYG0ymCbfx3YSpl4mFZI%2FS76TTfItMsLwzji6m00Y9QaTCBfP9Bla8SH2UC8KyS8107c75vp%2B4IpzD46o32%2BCJ3QcnnnSn5kGNf%2BctqvqALqLF2qHPaG%2FmnBV%2Bg6b2unryM3nONzWNONiRl%2BesZ0%2BsZ0293xuQ7XcYO3WvzkMmz7Rne4ZD9xTcN16Toq7571Xe%2Fib5zT%2FIVaYfCaPyjFd7YIOtW6hhoXgh5WzaV9bs3CRWrcnkVwUJCgkMo3TL%2BNKQMkpE8Qx5m5ROBBMgZggsCkuQmZtssZTiGx41z5blXTsf5AZBZ7h7wOobQKC%2F4vOp8db2RF3M9Xk67raZItFozaAWqn%2B36fIoyZjIv1xxkn8qCw98lzaqxHqttuwFG4O9w%2BMikHjw6qewmQwtugB9xYt%2B8wWuaSiyEgFAK8Hedd2RrctRxwrA6FUkluWbNNWHHRf5cELuur50jWHYaZMEuuth1xvUXtOBfPMEZ%2FYxlIMKytn8yairD7vuKbaXaEcnUCP2CogmP6LByrbDYxLu%2BuNkTHnsvNvo0x6XwMPQ17YGQAQjftUkPdS788oAYGYA4rTZe4iJLP78M0CiYGbBQzj%2FdhqmLcdS3ibIWl4oH1mHWQwm8Ov%2F66iSqvNFEU7TBtRlnQBFZrqvcyaUkrWfg6Ce5rRqcd0oRDM47pHB7KH%2F2IcWzpjkw6LsIjzfU71n6He6lNTrP557vh8%2Bic83ab7qPvhydOasw2rspvQCTR9p14NB1TMVgu3nwL%2FVmioJfnMaTM2kcPJPF33TU6GnvNt7pw0PdHV5FPG2Fv%2Br4UL57NN9%2Bq92P3y70Fv8D"></iframe>
<br> <br>

Note whilst this successfully deletes the stack resources in your target account, currently you will have to delete the stack set instance in your deletion account and the stack set itself in your payer account manually after your cloud-nuke solution has run before you click your iot button again. This is because a stack will try to be recreated with the same name as previously, and therefore it will fail. I am working on this change currently.

Solution Flow
Click IoT Button: A physical IoT button is clicked.
Trigger Lambda Function: The button click triggers a Lambda function in the management account.
Deploy Stack Set in Dev Account: The Lambda function deploys a CloudFormation stack set in the development account. This stack set includes a cloud-nuke EC2 instance and its associated role.
Run Cloud-Nuke: The cloud-nuke instance executes and deletes all resources within the development account, including itself and its associated resources.
First-Time Setup (Management Account)
Prerequisites
AWS Management and Development accounts under AWS Organizations.
An IoT button
a default VPC in the destination account
Steps
Launch Initial CloudFormation Stack:

Use first_template.yaml to create the initial resources.
This stack creates:
An S3 Bucket for the second CloudFormation template (delete-resources.yaml).
An S3 Bucket for the Lambda function's code (launch-stack.zip).
Prepare and Upload Lambda Function and cloudformation templates:

Zip the launch-stack.py file
Upload the zip file to the code S3 bucket created in step 1.
upload the two cloudformation templates (lambda.yaml and delete resources.yaml to the cloudformation bucket you just created.)
Deploy the Second Stack:

Use the S3 URL of lambda.yaml to deploy the second CloudFormation stack.
Provide parameters referring to:
The S3 bucket where the Lambda code resides.
The OU ID and account name for the target environment.
The S3 URL of the delete-resources.yaml template.
Manual Trigger Test:

Initially, trigger the Lambda function manually to validate the deployment of the cloud-nuke EC2 instance in your target account.
Optional: IoT Button Setup
To set up the IoT button as a trigger for the Lambda function, follow these steps:

Register and Configure IoT Button:

Register the IoT button in AWS IoT 1-Click and configure it to connect to your network.
Create IoT 1-Click Project:

Create a new project in IoT 1-Click and add the IoT button to this project.
Associate Lambda Function:

Link the Lambda function to the IoT button within the IoT 1-Click project.
Test Button Trigger:

Test the setup by pressing the IoT button and monitoring the execution of the Lambda function and the deployment of resources in the development account.